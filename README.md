# Сar price prediction service on FastAPI
Проект машинного обучения для прогнозирования цен на автомобили с использованием регрессионных моделей. Включает FastAPI-сервис для получения предсказаний в реальном времени.

## Описание работы

В рамках проекта была выполнена серия шагов по подготовке данных, выбору моделей и их оптимизации. Основное внимание уделялось обработке данных, созданию новых признаков, подбору гиперпараметров и анализу результатов с использованием кастомных метрик.

---

## Что было сделано

1. **Анализ данных (EDA):**
   - Проанализированы основные зависимости между признаками и целевой переменной.
   - Построены тепловые карты корреляции и выявлены признаки с наибольшим влиянием на целевую переменную.
   - Найдены потенциально значимые нелинейные зависимости.

2. **Предобработка данных:**
   - Выполнено заполнение пропусков медианами и внедрение dummy-столбцов для указания на места пропусков.
   - Применено логарифмирование и другие трансформации для приведения данных к более нормальному распределению.
   - Реализовано OneHot-кодирование для категориальных признаков с корректным учетом мультиколлинеарности.

3. **Feature engineering:**
   - Созданы новые признаки на основе анализа зависимостей, включая квадратичные и логарифмические преобразования.
   - Добавлены дополнительные признаки, такие как "количество лошадиных сил на единицу объема двигателя".

4. **Модели:**
   - Построены и обучены различные регрессионные модели, включая Lasso, Ridge и ElasticNet.
   - Подобраны оптимальные гиперпараметры с использованием GridSearchCV и кросс-валидации (10 фолдов).
   - Реализован FastAPI-сервис для работы с моделями:
     - Выдача предсказания стоимости по одному объекту.
     - Массовое предсказание стоимости по данным из загружаемого CSV-файла.

5. **Кастомные метрики:**
   - Реализованы бизнес-метрики для оценки качества моделей:
     - Первая метрика измеряла долю предсказаний, отклоняющихся от реальных значений не более чем на 10%.
     - Вторая метрика усиливала штраф за недопрогноз, так как он был признан более важным для бизнеса.
   - Проведен сравнительный анализ моделей по этим метрикам.

---

## Результаты

1. **Качество моделей:**
   - Лучшие результаты показала модель `Lasso` после обработки данных и добавления новых признаков:
     - $R^2$: `0.8232`
     - $MSE$: `101617170814.93`
   - Использование кастомной метрики подтвердило, что `Lasso` лучше всего решает задачу бизнеса, обеспечивая минимальные ошибки недопрогноза.

2. **Влияние feature engineering:**
   - Добавление квадратичного преобразования признака `year` дало наибольший прирост качества модели:
     - $R^2$ увеличилось с `0.7563` до `0.7931`.
   - Добавление нового признака на основе `engine` улучшило результат ещё на `0.03` по $R^2$.

3. **FastAPI-сервис:**
   - Успешно создан и протестирован. Поддерживает как одиночное предсказание, так и работу с файлами.
   - Обеспечивает интеграцию модели в реальное приложение.

---

## Что дало наибольший буст в качестве

1. **Создание новых признаков:**
   - Квадратичное преобразование года (`year`) оказалось ключевым, так как зависимость целевой переменной от этого признака изначально была нелинейной.
   - Логарифмирование числовых признаков, таких как `max_torque_rpm`, также положительно сказалось на качестве.

2. **Применение Lasso-регрессии:**
   - Регуляризация позволила исключить шумовые признаки, что улучшило обобщающую способность модели.

3. **Кастомные метрики:**
   - Оптимизация под бизнес-метрики позволила лучше соответствовать требованиям заказчика.

---

## Что не получилось

1. **Удаление нерелевантных признаков:**
   - Попытки удалить признаки с низкими коэффициентами в линейных моделях ухудшали качество, так как многие признаки оказывались полезными только в сочетании с другими.

2. **Использование ElasticNet:**
   - Модель ElasticNet не показала значительных улучшений. Возможно, это связано с доминирующим эффектом L1-регуляризации, который уже был реализован в Lasso.

3. **Работа с выбросами:**
   - Несмотря на анализ, удаление выбросов в данных не привело к улучшению качества модели, так как выбросы содержали важную информацию.

---

## Заключение

Проект продемонстрировал, что качественная предобработка данных и экспериментирование с признаками играют ключевую роль в построении успешной модели. FastAPI-сервис обеспечивает удобную интеграцию модели в реальный бизнес-сценарий, что делает решение практически применимым. Однако удаление шумовых данных и работа с выбросами требуют дополнительного изучения.





